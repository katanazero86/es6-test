'use strict';

const promiseExample = () => {

    /**
     * 다음 주어진, 코드를 이용하요 numbers 배열의 모든 합을 계산하시오.
     * 모 회사 코딩 테스트2 / 면접 가니, 손코딩 문제를 줬다. promise 가 공부가 안된 상태에서 할려니..쩝;
     */

    console.log('promise 예제 start--------------------------------------------------');
    const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
    let sumResult = 0;

    function addNumber(a, b) {
        return new Promise((resolve => {
            resolve(a + b);
        }));
    }

    // function addNumber(a, b) {
    //     return new Promise(function (resolve, reject) {
    //         resolve(a + b)
    //     });
    // }



    numbers.forEach((value, index) => {

        addNumber(value, sumResult)
            .then(function (resolve) {
                sumResult = resolve;
            });

    });
    console.log(sumResult);
    console.log('promise 예제 end--------------------------------------------------');

};

const readline = require('readline');

promiseExample();

const readlineInterfaceModule = (() => {
    return {
        init: () => {
            return readline.createInterface({
                input: process.stdin,
                output: process.stdout
            });
        }
    }
})();

const calculatorModule = (() => {
    return {
        executeCalculate: (line) => {

            if (!calculatorModule.validationLine(line)) {
                console.log('잘못된 입력입니다. 다시 입력해주세요.');
                return false;
            }
            console.log('결과 :', eval(line));
        },

        validationLine: (line) => {
            let result = true;
            let lastChar = line.charAt(line.length - 1);
            var regExp = /[a-zA-Z가-힣]/; //한글과 영문이 포함되어있는지에 대한 정규식
            if (lastChar != ')' && isNaN(lastChar)) {
                return false;
            }

            if (regExp.test(line)) {
                console.log('한글 또는 영어가 포함되어 있음');
                return false;
            }

            return result;
        }

    }
})();

let readlineInterface = readlineInterfaceModule.init();
readlineInterface.setPrompt('계산하실 값을 입력하세요.(예: 1+2*3  결과: 7) > ');
readlineInterface.prompt();
readlineInterface.on('line', (line) => {
    if (line === 'exit') {
        readlineInterface.close();
    }
    calculatorModule.executeCalculate(line);
    readlineInterface.prompt();
});


readlineInterface.on('close', () => {
    process.exit();
});
